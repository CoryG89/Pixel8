var Pixel8=function(){"use strict";var Pixel8=function Pixel8(element,options,globalOptions){if(!isCanvasSupported())throw new Error("Pixel8:  requires HTML5 canvas support");if(Pixel8.options={clearColor:null},setOptions(globalOptions),"[object HTMLCanvasElement]"===getType(element))Pixel8.render(element,options);else if("[object HTMLImageElement]"===getType(element))Pixel8.processImage(element,options);else{if("[object HTMLVideoElement]"!==getType(options))throw new Error("Pixel8:  unsupported element type");Pixel8.processVideo(element,options)}},setOptions=function(options){options&&options.clearColor&&(Pixel8.options.clearColor=options.clearColor)},Pixel=function(imageData,x,y){this.getData=function(imageData,x,y){this.index=4*(y*imageData.width+x),this.r=imageData.data[this.index],this.g=imageData.data[this.index+1],this.b=imageData.data[this.index+2],this.a=imageData.data[this.index+3]},this.toString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},imageData&&x&&y&&this.getData(imageData,x,y)},getType=function(object){return Object.prototype.toString.call(object)},isCanvasSupported=function(){var element=document.createElement("canvas");return!(!element.getContext||!element.getContext("2d"))},getCanvasFromElement=function(element){var canvas=document.createElement("canvas"),context=canvas.getContext("2d");return canvas.className=element.className,canvas.id=element.id,canvas.width=element.width,canvas.height=element.height,context.drawImage(element,0,0,canvas.width,canvas.height),canvas},getImageFromCanvas=function(canvas,image){return image||(image=new Image),image.onload=function(previousOnLoad){return function(){this.onload=previousOnLoad}}(image.onload),image.src=canvas.toDataURL("image/png"),image},clearCanvas=function(canvas){var context=canvas.getContext("2d");if(context.clearRect(0,0,canvas.width,canvas.height),Pixel8.options.clearColor){var prevFillStyle=context.fillStyle;context.fillStyle=Pixel8.options.clearColor,context.fillRect(0,0,canvas.width,canvas.height),context.fillStyle=prevFillStyle}};return Pixel8.processImage=function(image,options,globalOptions){var canvas=getCanvasFromElement(image);Pixel8.render(canvas,options),globalOptions&&globalOptions.replaceImage?image.parentElement.replaceChild(canvas,video):getImageFromCanvas(canvas,image)},Pixel8.processVideo=function(video,options){var canvas=getCanvasFromElement(video);Pixel8.render(canvas,options),video.parentElement.replaceChild(canvas,video)},Pixel8.render=function(canvas,options){var context=canvas.getContext("2d"),imgData=context.getImageData(0,0,canvas.width,canvas.height);if(clearCanvas(canvas),"[object Object]"===getType(options))Pixel8.renderPass(context,imgData,options);else{if("[object Array]"!==getType(options))throw new Error("Pixel8.render:  unsupported options type");for(var i=0;i<options.length;i++)Pixel8.renderPass(context,imgData,options[i])}},Pixel8.renderPass=function(ctx,imgData,options){var width=imgData.width,height=imgData.height,resolution=options.resolution||16,size=options.size||resolution,shape=options.shape||"square",alpha=options.alpha||1,offset=options.offset||0,offsetX=0,offsetY=0,offsetType=getType(offset);"[object Object]"===offsetType?(offsetX=offset.x||0,offsetY=offset.y||0):"[object Array]"===offsetType?(offsetX=offset[0]||0,offsetY=offset[1]||0):offsetX=offsetY=offset;for(var rows=height/resolution+1,columns=width/resolution+1,pixel=new Pixel,row=0;rows>row;row++)for(var y=(row-.5)*resolution+offsetY,pixelY=Math.max(Math.min(y,height-1),0),col=0;columns>col;col++){var x=(col-.5)*resolution+offsetX,pixelX=Math.max(Math.min(x,width-1),0);pixel.getData(imgData,pixelX,pixelY),pixel.a=alpha/(pixel.a/255),ctx.fillStyle=pixel.toString(),Pixel8.draw[shape](ctx,x,y,size)}},Pixel8.draw={square:function(ctx,x,y,size){var halfSize=size/2;ctx.fillRect(x-halfSize,y-halfSize,size,size)},circle:function(ctx,x,y,size){ctx.beginPath(),ctx.arc(x,y,size/2,0,2*Math.PI,!0),ctx.fill(),ctx.closePath()},diamond:function(ctx,x,y,size){size/=Math.SQRT2;var halfSize=size/2;ctx.save(),ctx.translate(x,y),ctx.rotate(Math.PI/4),ctx.fillRect(-halfSize,-halfSize,size,size),ctx.restore()},star:function(ctx,x,y,size){size/=Math.SQRT2,ctx.save(),ctx.beginPath(),ctx.translate(x,y),ctx.moveTo(0,0-size);for(var i=0;5>i;i++)ctx.rotate(Math.PI/5),ctx.lineTo(0,0-size/2),ctx.rotate(Math.PI/5),ctx.lineTo(0,0-size);ctx.fill(),ctx.restore()}},Pixel8}();